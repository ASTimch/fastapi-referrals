## Описание
Пример реализации API сервиса реферальной системы на FastAPI.

## Основная логика
- регистрация и аутентификация пользователя (JWT, Oauth 2.0);
- аутентифицированный имеет возможность создать/обновить удалить свой реферальный код. При создании кода задается его срок годности;
- получение реферального кода по email адресу реферера;
- возможность регистрации по реферальному коду в качестве реферала;	
- получение информации о рефералах по id реферера;
- получение реферального кода на email.

### Технологии
- **Python - 3.10**
- **FastAPI**
- **SQLAlchemy - 2.0**
- **Pydantic - 2.5**
- **PostgreSQL**
- **pytest**
- **Redis**
- **Docker**
- **nginx**

## Подготовка и запуск проекта:

Клонируйте репозиторий:

```bash
    git clone  git@github.com:ASTimch/fastapi-referrals.git
```

## Сборка и запуск docker-контейнеров проекта:

### Сформировать файл настроек окружения:
  Файл .env подготовить в соответствии с шаблоном .env.example
  Файл .env-prod подготовить в соответствии с шаблоном .env-prod.example

### Сборка и запуск оркестра контейнеров:
```
    docker compose up --build
```

### Просмотр документации по api:
```
    localhost/api/v1/docs
    localhost/api/v1/redoc
```

## Описание маршрутов:

#### Регистрация нового пользователя:
POST запрос по адресу /api/v1/auth/register

#### Авторизация пользователя:
POST запрос по адресу /api/v1/auth/login

#### Получение полной информации об авторизованном пользователе, его рефералах и реферере:
GET запрос по адресу /api/v1/auth/me

Схема ответа:
```
{
  "referrals": [
    {
      "id": int,
      "email": str
    }
  ],
  "id": int,
  "email": str,
  "referrer": {
    "id": int,
    "email": str
  }
}
```

#### Создание нового реферального кода авторизованного пользователя:
  POST запрос по адресу /api/v1/referral_code/
  
  В теле запроса указать время срок годности кода (в минутах)
```
{
    "code_lifetime": 1440
}
```

#### Просмотр текущего реферального кода авторизованного пользователя:
  GET запрос по адресу /api/v1/referral_code/

  В качестве ответа возвращаются данные реферального кода (при его наличии) в виде
```
{
  "id": int,
  "code": str
}
```

#### Просмотр информации обо всех рефералах по id реферера:
GET запрос по адресу /api/v1/referrals/{referrer_id}/

Схема ответа:
```
{
  "referrals": [
    {
      "id": int,
      "email": str
    }
  ]
}
```

#### Отправить реферальный код на почту, указанную при регистрации:
GET запрос по адресу /api/v1/email_referral_code/


## Разворачивание проекта без использования docker-образов:

### Создать виртуальное окружение:
```
    python -m venv venv
```
#### Активировать виртуальное окружение, Если у вас Linux/macOS
```
    source venv/bin/activate
```
#### Активировать виртуальное окружение, Если у вас windows
```
    source venv/scripts/Activate
```

### Установить зависимости из файла requirements.txt:
```
    python -m pip install --upgrade pip
    pip install -r requirements.txt
```
### Сформировать файл настроек окружения:
Файл .env подготовить в соответствии с шаблоном .env.example

### Выполнить миграции:
```
    alembic upgrade head
```

### Запустить проект:
```
    uvicorn app.main:app --reload
```

### Просмотр документации по api:
```
    localhost:8000/api/v1/docs
    localhost:8000/api/v1/redoc
```

### Запуск тестов:
```
    pytest . --log-disable=referrals
```